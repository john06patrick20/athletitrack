{% extends "base.html" %}
{% load static %}
{% load custom_filters %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<!-- ===============================
     Welcome Banner
================================ -->
<div class="hero-banner mb-4">
  <div class="slide" style="background-image: url('{% static 'images/bg1.jpg' %}');"></div>
  <div class="slide" style="background-image: url('{% static 'images/bg2.jpg' %}');"></div>
  <div class="slide" style="background-image: url('{% static 'images/bg3.jpg' %}');"></div>
  <div class="slide" style="background-image: url('{% static 'images/bg4.jpg' %}');"></div>
  
  <div class="hero-content text-center text-white">
    <h1 class="display-5 fw-bold">Welcome to AthletiTrack</h1>
    <p class="col-md-8 fs-4 mx-auto">
      The central hub for managing athlete performance and events at EVSU.
    </p>
  </div>
</div>


<!-- ===============================
     Personalized Dashboard
================================ -->
{% if user.is_authenticated %}
  {% if user.role == 'COACH' %}
  <!-- Coach Dashboard -->
  <h3 class="mb-3">Coach Dashboard</h3>
  <div class="row">
    <div class="col-md-6 mb-4">
      <h4>My Relevant Events</h4>
      <div class="list-group">
        {% for event in my_events %}
          <a href="{% url 'event-detail' pk=event.pk %}" class="list-group-item list-group-item-action">
            {{ event.name }} <small class="text-muted">({{ event.start_time|date:"M d" }})</small>
          </a>
        {% empty %}
          <div class="list-group-item">No events found for your sport/campus.</div>
        {% endfor %}
      </div>
    </div>

    <div class="col-md-6 mb-4">
      <h4>My Athletes ({{ my_athletes.count }})</h4>
      <div class="list-group">
        {% for athlete in my_athletes %}
          <a href="{{ athlete.get_absolute_url }}" class="list-group-item list-group-item-action d-flex align-items-center">
            {% if athlete.user.image %}
              <img src="{{ athlete.user.image.url }}" class="rounded-circle me-2" style="width:30px; height:30px; object-fit:cover;">
            {% endif %}
            {{ athlete.user.get_full_name }}
          </a>
        {% empty %}
          <div class="list-group-item">No athletes are assigned to you.</div>
        {% endfor %}
      </div>
    </div>
  </div>

  {% elif user.role == 'ATHLETE' %}
  <!-- Athlete Dashboard -->
  <h3 class="mb-3">Athlete Dashboard</h3>
  <div class="row">
    <div class="col-md-6 mb-4">
      <h4>My Events</h4>
      <div class="list-group">
        {% for event in my_events %}
          <a href="{% url 'event-detail' pk=event.pk %}" class="list-group-item list-group-item-action">
            {{ event.name }} <small class="text-muted">({{ event.start_time|date:"M d" }})</small>
          </a>
        {% empty %}
          <div class="list-group-item">You are not registered for any events.</div>
        {% endfor %}
      </div>
    </div>

    <div class="col-md-6 mb-4">
      <h4>My Coach</h4>
      {% if my_coach %}
        <a href="{{ my_coach.get_absolute_url }}" class="text-decoration-none">
          <div class="card">
            <div class="card-body d-flex align-items-center">
              {% if my_coach.user.image %}
                <img src="{{ my_coach.user.image.url }}" class="rounded-circle me-3" style="width:50px; height:50px; object-fit:cover;">
              {% endif %}
              <div>
                <h5 class="card-title mb-0">{{ my_coach.user.get_full_name }}</h5>
                <p class="card-text text-muted mb-0">{{ my_coach.sport }} - {{ my_coach.campus }}</p>
              </div>
            </div>
          </div>
        </a>
      {% else %}
        <div class="list-group-item">No coach is assigned to your sport/campus.</div>
      {% endif %}
    </div>
  </div>
  {% endif %}
  <hr class="my-4">
{% endif %}

<!-- ===============================
     Recently Added Athletes
================================ -->
{% if recent_athletes %}
<div class="mt-4">
  <h2 class="text-center mb-4">Recently Added Athletes</h2>
  <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-5 g-4">
    {% for athlete in recent_athletes %}
    <div class="col">
      {% if user.is_authenticated %}
        <a href="{{ athlete.get_absolute_url }}" class="text-decoration-none">
      {% endif %}
      <div class="card shadow-sm h-100 card-hover">
        {% if athlete.user.image %}
          <img src="{{ athlete.user.image.url }}" class="card-img-top" style="height: 180px; object-fit: cover;" alt="{{ athlete.user.get_full_name }}">
        {% else %}
          <img src="{% static 'images/default_profile.png' %}" class="card-img-top" style="height: 180px; object-fit: cover;" alt="Default Profile">
        {% endif %}
        <div class="card-body text-center">
          <h6 class="card-title text-dark">{{ athlete.user.get_full_name }}</h6>
          <p class="card-text small text-muted mb-0">
            {{ athlete.team.sport.name|default:"No sport" }} - {{ athlete.team.campus.name|default:"No campus" }}
          </p>
        </div>
      </div>
      {% if user.is_authenticated %}
        </a>
      {% endif %}
    </div>
    {% endfor %}
  </div>
</div>
{% endif %}

<hr class="my-4">

{% endblock %}
